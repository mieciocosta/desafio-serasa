Perfeito üëç
Segue um **README LIMPO, direto e profissional**, pronto para **colar sem ajuste**.
Usei t√≠tulos claros, passo a passo objetivo, JSONs separados e crit√©rios de valida√ß√£o.

---

# üß™ Testes MED ‚Äì Recupera√ß√£o de Valores (SIGCN)

Este documento descreve **como executar e validar os testes** do fluxo de Recupera√ß√£o de Valores utilizando **IDs reais**, filas do **Azure Service Bus** e **Cosmos DB**.

---

## üìå Filas Envolvidas

* **Entrada (postagem de testes)**
  `sigcn-med-solicitacaorecuperacao-recebimento`

* **Retorno (sucesso ‚Äì canal digital)**
  `sigcn-med-solicitacaorecuperacao-retorno`

* **Falhas (erro de valida√ß√£o / erro funcional)**
  `sigcn-med-falhas-solicitacaorecuperacao-envio`

* **Mensagens Mortas (DLQ)**
  Aba *Mensagens mortas* da fila de recebimento

---

## ‚ö†Ô∏è Pr√©-requisito Importante

O namespace do Service Bus possui **acesso p√∫blico desabilitado**.

Antes de testar:

1. Estar conectado √† **rede/VPN corporativa**, ou
2. Ter o **IP liberado** no namespace
3. Clicar em **‚ÄúAlternar para a Rede‚Äù** no topo da fila
4. Atualizar a p√°gina

Sem isso, **n√£o ser√° poss√≠vel enviar ou espiar mensagens**.

---

## üß© Massa de IDs de Transa√ß√£o (BACEN)

### ‚úÖ IDs FUNCIONAIS (usar para sucesso)

```
E00360305202601142342a2c61528410
E00360305202601142342b1c2ba87263
E00360305202601142343ef45a64aefd
E00360305202601142343a70ead682b8
```

### ‚ö†Ô∏è IDs N√ÉO INDEXADOS (erro funcional esperado)

```
E003603052026011420262b6f5ae914f
E00360305202601142027c313b4f493c
```

### ‚ùå IDs COM HIST√ìRICO DE DLQ

```
E00360305202601142349ed5d917f9a6
```

---

## üß™ TESTE 1 ‚Äî Sucesso (Happy Path)

### Objetivo

Criar pedido de recupera√ß√£o com sucesso utilizando **ID real funcional**.

### Onde postar

Fila:
`sigcn-med-solicitacaorecuperacao-recebimento`

### JSON

```json
{
  "teste_miecio": "SUCESSO_REAL_001",
  "IdFimaFim": "MIECIO_FIMAFIM_OK_001",
  "idTransacao": "E00360305202601142342a2c61528410",
  "origem": "SICONT",
  "valor": 150.75,
  "dataSolicitacao": "2026-01-21T16:10:00Z",
  "motivo": "FRAUDE_GOLPE"
}
```

### Valida√ß√£o Esperada

* Fila de recebimento: mensagem consumida (Fila = 0)
* Fila de retorno:

  * Retorno com `idRecuperacaoValor` e/ou `protocolo` (quando aplic√°vel)
* Cosmos DB:

  * Documento criado
  * `status = CRIADO`
  * `idTransacao` igual ao enviado

---

## üß™ TESTE 2 ‚Äî Erro Funcional (Transa√ß√£o n√£o indexada)

### Objetivo

Validar tratamento de erro funcional retornado pelo BACEN/SISPI.

### JSON

```json
{
  "teste_miecio": "ERRO_BACEN_001",
  "IdFimaFim": "MIECIO_FIMAFIM_ERRO_BACEN",
  "idTransacao": "E003603052026011420262b6f5ae914f",
  "origem": "SICONT",
  "valor": 200.00,
  "dataSolicitacao": "2026-01-21T16:20:00Z",
  "motivo": "FRAUDE_GOLPE"
}
```

### Valida√ß√£o Esperada

* Mensagem processada
* Registro de erro salvo no banco
* Mensagem pode aparecer na fila:

  * `sigcn-med-falhas-solicitacaorecuperacao-envio`
* **N√£o deve ir para DLQ**

---

## üß™ TESTE 3 ‚Äî Dead Letter Queue (DLQ)

### Objetivo

Validar envio para mensagens mortas ap√≥s falhas repetidas.

### JSON

```json
{
  "teste_miecio": "DLQ_001",
  "IdFimaFim": "MIECIO_FIMAFIM_DLQ",
  "idTransacao": "E00360305202601142349ed5d917f9a6",
  "origem": "SICONT",
  "valor": 300.00,
  "dataSolicitacao": "2026-01-21T16:30:00Z",
  "motivo": "FRAUDE_GOLPE"
}
```

### Valida√ß√£o Esperada

* Ap√≥s tentativas de reprocessamento:

  * Mensagem aparece em **Mensagens Mortas**
* Corpo da mensagem cont√©m o `idTransacao` enviado
* Nenhum status de sucesso no Cosmos

---

## üß™ TESTE 4 ‚Äî Status ANALYZED (Disparo de Devolu√ß√£o)

### Objetivo

Validar o fluxo de devolu√ß√£o quando a an√°lise √© conclu√≠da.

### JSON (fila de mudan√ßa de status)

```json
{
  "teste_miecio": "ANALYZED_REAL_001",
  "IdFimaFim": "MIECIO_FIMAFIM_OK_001",
  "IDRecuperacao": "E00360305202601142342a2c61528410",
  "status": "ANALYZED",
  "timestamp": "2026-01-21T16:40:00Z"
}
```

### Valida√ß√£o Esperada

* SIGCN identifica status `ANALYZED`
* Cria JSON de solicita√ß√£o de devolu√ß√£o
* Tenta chamada ao endpoint do SISPI
* Em erro:

  * Registro salvo no container
    `med-devolucao-solicitacoes`

---

## üîç Valida√ß√£o no Cosmos DB (exemplo de query)

```sql
SELECT * FROM c
WHERE c.idTransacao = "E00360305202601142342a2c61528410"
```

Verificar:

* Status do pedido
* Timestamp de cria√ß√£o
* IdFimAFim / idTransacao

---

## ‚úÖ Regra de Ouro

* Sempre usar **idTransacao real**
* Sucesso ‚â† apenas fila vazia ‚Üí **validar Cosmos**
* Erro funcional ‚â† DLQ
* DLQ s√≥ ocorre em erro t√©cnico ou reprocessamento excedido

---

Se quiser, posso:

* gerar uma **tabela de evid√™ncias (print obrigat√≥rio por teste)**
* ou adaptar esse README para **padr√£o corporativo CAIXA** (header, vers√£o, respons√°vel, data).
